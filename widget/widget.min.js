const themes=[{id:"default",color:"#0f172a",text:"#ffffff"},{id:"sunset",color:"#431407",text:"#ffffff"},{id:"forest",color:"#022c22",text:"#ffffff"},{id:"berry",color:"#500724",text:"#ffffff"},{id:"abyss",color:"#000000",text:"#ffffff"},{id:"cloud",color:"#f0f9ff",text:"#0c4a6e"},{id:"peach",color:"#fff7ed",text:"#9a3412"},{id:"mint",color:"#ecfdf5",text:"#065f46"},{id:"lilac",color:"#faf5ff",text:"#6b21a8"},{id:"sand",color:"#fffbeb",text:"#92400e"},{id:"navy",color:"#0f172a",text:"#ffffff"},{id:"crimson",color:"#450a0a",text:"#ffffff"},{id:"charcoal",color:"#18181b",text:"#ffffff"},{id:"violet",color:"#2e1065",text:"#ffffff"},{id:"emerald",color:"#064e3b",text:"#ffffff"},{id:"rose",color:"#fff1f2",text:"#9f1239"},{id:"sky",color:"#f0f9ff",text:"#075985"},{id:"lemon",color:"#fefce8",text:"#854d0e"},{id:"ivory",color:"#fafaf9",text:"#57534e"},{id:"ice",color:"#ecfeff",text:"#155e75"}],supportedLangs=[{id:"it",label:"Italiano",flag:"it"},{id:"en",label:"English",flag:"gb"},{id:"es",label:"Español",flag:"es"},{id:"fr",label:"Français",flag:"fr"},{id:"de",label:"Deutsch",flag:"de"},{id:"pt",label:"Português",flag:"pt"},{id:"ru",label:"Русский",flag:"ru"},{id:"zh",label:"中文",flag:"cn"},{id:"ja",label:"日本語",flag:"jp"},{id:"ko",label:"한국어",flag:"kr"},{id:"ar",label:"العربية",flag:"sa"},{id:"hi",label:"हिन्दी",flag:"in"},{id:"tr",label:"Türkçe",flag:"tr"},{id:"nl",label:"Nederlands",flag:"nl"},{id:"pl",label:"Polski",flag:"pl"},{id:"sv",label:"Svenska",flag:"se"},{id:"vi",label:"Tiếng Việt",flag:"vn"},{id:"th",label:"ไทย",flag:"th"},{id:"el",label:"Ελληνικά",flag:"gr"},{id:"uk",label:"Українська",flag:"ua"}];let translations={},currentLang=localStorage.getItem("countdown_lang");if(!currentLang){const e=(navigator.language||"it").split("-")[0];currentLang=supportedLangs.some(t=>t.id===e)?e:"it"}function t(e){return translations[currentLang]&&translations[currentLang][e]||e}async function loadTranslations(){await applyLanguage(currentLang)}async function applyLanguage(e){if(!translations[e])try{let t=await fetch(`../assets/languages/${e}.json`);t.ok||(t=await fetch(`../../assets/languages/${e}.json`)),t.ok&&(translations[e]=await t.json())}catch(e){console.error("Translation load error:",e)}translations[e]&&(translations[e].modal_sound_title||(translations[e].modal_sound_title="it"===e?"Impostazioni Suono":"Sound Settings"),translations[e].tick_sound_label||(translations[e].tick_sound_label="it"===e?"Suono Ticchettio":"Tick Sound"),translations[e].alarm_sound_label||(translations[e].alarm_sound_label="it"===e?"Suono Allarme":"Alarm Sound"),translations[e].widget_generator_title||(translations[e].widget_generator_title="Widget Generator"),translations[e].generate_widget_btn||(translations[e].generate_widget_btn="it"===e?"Genera Widget":"Generate Widget"),translations[e].copy_code_btn||(translations[e].copy_code_btn="it"===e?"Copia Codice":"Copy Code"),translations[e].copied_msg||(translations[e].copied_msg="it"===e?"Copiato!":"Copied!"),translations[e].timer_title_placeholder||(translations[e].timer_title_placeholder="it"===e?"Titolo del Timer (opzionale)":"Timer Title (optional)"),translations[e].hours_label||(translations[e].hours_label="it"===e?"ORE":"HOURS"),translations[e].minutes_label||(translations[e].minutes_label="it"===e?"MINUTI":"MINUTES"),translations[e].preview_label||(translations[e].preview_label="it"===e?"Anteprima":"Preview"),translations[e].back_btn||(translations[e].back_btn="it"===e?"Modifica":"Edit")),currentLang=e,document.documentElement.setAttribute("lang",e),document.documentElement.setAttribute("data-lang",e),document.querySelectorAll("[data-i18n]").forEach(e=>{const n=e.getAttribute("data-i18n");n&&(e.textContent=t(n))}),document.querySelectorAll("[data-i18n-placeholder]").forEach(e=>{e.placeholder=t(e.getAttribute("data-i18n-placeholder"))})}function setupWidgetControls(){setupCustomSelect("widget-lang-select",supportedLangs,currentLang,e=>{updateWidgetCode(!1)}),setupCustomSelect("widget-theme-select",themes,"default",e=>{updateWidgetCode(!1)},!0),["widget-tick-toggle","widget-alarm-toggle","widget-anim-toggle"].forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("input",()=>updateWidgetCode(!1))})}function setupCustomSelect(e,n,a,o,s=!1){const r=document.getElementById(e);if(!r)return;r.dataset.value=a;const l=document.createElement("div");l.className="select-trigger";const i=e=>s?t("theme_"+e.id):e.label,d=n.find(e=>e.id===a)||n[0],c=document.createElement("div");c.style.cssText="display: flex; align-items: center; gap: 10px; flex: 1; overflow: hidden;";const u=document.createElement("span"),m=document.createElement("input");m.type="text",m.className="select-input",m.readOnly=!0,m.placeholder=t("search_placeholder");const g=document.createElement("i");g.className="fa-solid fa-chevron-down",c.appendChild(u),c.appendChild(m),l.appendChild(c),l.appendChild(g);const f=e=>{u.innerHTML="",u.style.display="none",s?(u.style.display="flex",u.style.alignItems="center",u.innerHTML=`<span class="theme-dot" style="background: ${e.color}"></span>`):e.flag&&(u.style.display="flex",u.style.alignItems="center",u.innerHTML=`<img src="https://flagcdn.com/24x18/${e.flag}.png" alt="${e.flag}" style="width: 20px; height: 15px; object-fit: cover; border-radius: 2px;">`),m.value=i(e)};f(d);const p=document.createElement("div");p.className="select-options";const h=(e="")=>{p.innerHTML="";const a=e.toLowerCase();let l=!1;if(n.forEach(e=>{const t=i(e);if(a&&!t.toLowerCase().includes(a))return;l=!0;const n=document.createElement("div");n.className="custom-option",e.id===r.dataset.value&&n.classList.add("selected"),n.innerHTML=`\n        ${s?`<span class="theme-dot" style="background: ${e.color}"></span>`:""}\n        ${e.flag?`<img src="https://flagcdn.com/24x18/${e.flag}.png" alt="${e.flag}" style="width: 20px; height: 15px; object-fit: cover; border-radius: 2px;">`:""}\n        <span>${t}</span>\n    `,n.addEventListener("click",t=>{t.stopPropagation(),r.dataset.value=e.id,f(e),r.classList.remove("open"),r.resetInput&&r.resetInput(),o&&o(e.id)}),p.appendChild(n)}),!l){const e=document.createElement("div");e.className="custom-option",e.style.cursor="default",e.textContent="Search..."===t("search_placeholder")?"No results":"Nessun risultato",p.appendChild(e)}};h(),r.appendChild(l),r.appendChild(p),l.addEventListener("click",e=>{e.stopPropagation();const t=r.classList.contains("open");document.querySelectorAll(".custom-select").forEach(e=>{e!==r&&(e.classList.remove("open"),e.resetInput&&e.resetInput())}),t?e.target!==m&&(r.classList.remove("open"),r.resetInput&&r.resetInput()):(r.classList.add("open"),m.readOnly=!1,m.focus(),m.select(),h(""))}),m.addEventListener("input",e=>{r.classList.contains("open")||r.classList.add("open"),h(e.target.value)}),r.resetInput=()=>{const e=r.dataset.value,t=n.find(t=>t.id===e);t&&f(t),m.readOnly=!0,m.blur()}}function setupAnimationSwitcher(){applyAnimationState("false"!==localStorage.getItem("countdown_animation"))}function applyAnimationState(e){document.body.classList.toggle("no-animations",!e)}function startBlobAnimation(){const e=document.querySelectorAll(".blob");!function t(){document.body.classList.contains("no-animations")||(e.forEach(e=>{const t=Math.random()*(window.innerWidth-e.clientWidth),n=Math.random()*(window.innerHeight-e.clientHeight);e.style.transform=`translate(${t}px, ${n}px)`}),setTimeout(t,2e4))}()}function showNotification(e){const t=document.querySelector(".custom-notification");t&&t.remove();const n=document.createElement("div");n.className="custom-notification",n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.style.animation="slide-out-left 0.5s forwards",n.addEventListener("animationend",()=>{n.parentNode&&n.remove()})},3e3)}function updateWidgetCode(e=!1){const n=document.getElementById("hours").value,a=document.getElementById("minutes").value;if(0===(parseInt(n)||0)&&0===(parseInt(a)||0))return void(e&&showNotification(t("notif_min_time")));const o=document.getElementById("timer-title-input"),s=o?o.value:"",r=document.getElementById("widget-theme-select"),l=r?r.dataset.value:"default",i=new URL("template/wt.html",window.location.href).href.split("?")[0],d=new URL(i);d.searchParams.set("widget","true"),d.searchParams.set("theme",l);const c=document.getElementById("widget-lang-select");d.searchParams.set("lang",c?c.dataset.value:currentLang),n>0&&d.searchParams.set("h",n),a>0&&d.searchParams.set("m",a),s&&d.searchParams.set("title",s);const u=document.getElementById("widget-tick-toggle"),m=document.getElementById("widget-alarm-toggle");d.searchParams.set("tick",!!u&&u.checked),d.searchParams.set("alarm",!!m&&m.checked),d.searchParams.set("tickVol",1),d.searchParams.set("alarmVol",1);const g=document.getElementById("widget-anim-toggle");g&&d.searchParams.set("anim",g.checked);const f=document.getElementById("transparent-bg-toggle"),p=document.getElementById("widget-preview-wrapper");f&&f.checked?(d.searchParams.set("bg","transparent"),p&&(p.style.background="transparent")):p&&(p.style.background="rgba(0,0,0,0.1)");const h=document.getElementById("hide-btn-toggle");h&&h.checked&&d.searchParams.set("hideBtn","true");const y=document.getElementById("auto-restart-toggle");y&&y.checked&&d.searchParams.set("autoRestart","true");let b="";b="script"===(document.querySelector('input[name="embed_method"]:checked')?.value||"iframe")?`<script>\n(function() {\n  var f = document.createElement('iframe');\n  f.src = "${d.toString()}";\n  f.style.cssText = "width:100%;height:600px;border:0;";\n  f.allow = "autoplay; fullscreen";\n  document.currentScript.parentNode.insertBefore(f, document.currentScript);\n})();\n<\/script>`:`<iframe src="${d.toString()}" width="100%" height="600" frameborder="0" allow="autoplay; fullscreen"></iframe>`;const v=document.getElementById("widget-output"),w=document.getElementById("config-section"),E=document.getElementById("widget-code");if(E.value=b,e){if(w&&w.classList.add("hidden"),p){p.innerHTML="";const e=document.createRange().createContextualFragment(b);p.appendChild(e);const t=p.querySelector("iframe");t&&(t.style.width="100%",t.style.height="100%")}v.classList.remove("hidden"),v.scrollIntoView({behavior:"smooth"})}requestAnimationFrame(()=>{autoResizeTextarea(E),E.scrollTop=0})}document.addEventListener("click",()=>{document.querySelectorAll(".custom-select").forEach(e=>{e.classList.remove("open"),e.resetInput&&e.resetInput()})}),document.querySelectorAll('.range-wrapper input[type="range"]').forEach(e=>{const t=()=>{const t=(e.value-e.min)/(e.max-e.min)*100;e.style.setProperty("--range-progress",`${t}%`)};e.addEventListener("input",t),t()}),document.getElementById("generate-btn").addEventListener("click",()=>updateWidgetCode(!0)),document.querySelectorAll('input[name="embed_method"]').forEach(e=>{e.addEventListener("change",()=>updateWidgetCode(!1))}),document.getElementById("copy-btn").addEventListener("click",()=>{document.getElementById("widget-code").select(),document.execCommand("copy");const e=document.getElementById("copy-btn"),n=e.innerHTML;e.innerHTML=`<i class="fa-solid fa-check"></i> ${t("copied_msg")}`,setTimeout(()=>e.innerHTML=n,2e3)});const backBtn=document.getElementById("back-to-config-btn");backBtn&&backBtn.addEventListener("click",()=>{document.getElementById("widget-output").classList.add("hidden"),document.getElementById("config-section").classList.remove("hidden");const e=document.getElementById("widget-preview-wrapper");e&&(e.innerHTML="")}),document.addEventListener("DOMContentLoaded",()=>{const e=loadTranslations(),t=document.getElementById("loading-screen"),n=document.querySelector(".loader-bar"),a=document.querySelector(".loader-percentage"),o=document.querySelector(".loader-text");if(t&&n){let s=0;const r={it:["Caricamento risorse...","Preparazione font...","Configurazione temi...","Avvio sistema...","Pronto!"],en:["Loading resources...","Preparing fonts...","Configuring themes...","Starting system...","Ready!"],es:["Cargando recursos...","Preparando fuentes...","Configurando temas...","Iniciando sistema...","¡Listo!"],fr:["Chargement des ressources...","Préparation des polices...","Configuration des thèmes...","Démarrage du système...","Prêt!"],de:["Ressourcen laden...","Schriftarten vorbereiten...","Themen konfigurieren...","System starten...","Bereit!"],pt:["Carregando recursos...","Preparando fontes...","Configurando temas...","Iniciando sistema...","Pronto!"],ru:["Загрузка ресурсов...","Подготовка шрифтов...","Настройка тем...","Запуск системы...","Готово!"],zh:["加载资源...","准备字体...","配置主题...","启动系统...","准备就绪！"],ja:["リソースを読み込んでいます...","フォントを準備中...","テーマを設定中...","システムを起動中...","準備完了！"],ko:["리소스를 로드 중...","글꼴 준비 중...","테마 구성 중...","시스템 시작 중...","준비 완료!"],ar:["جارٍ تحميل الموارد...","جارٍ إعداد الخطوط...","جارٍ تكوين السمات...","جارٍ بدء النظام...","جاهز!"],hi:["संसाधन लोड हो रहे हैं...","फ़ॉन्ट तैयार किए जा रहे हैं...","थीम कॉन्फ़िगर की जा रही हैं...","सिस्टम शुरू हो रहा है...","तैयार!"],tr:["Kaynaklar yükleniyor...","Yazı tipleri hazırlanıyor...","Temalar yapılandırılıyor...","Sistem başlatılıyor...","Hazır!"],nl:["Bronnen laden...","Lettertypen voorbereiden...","Thema's configureren...","Systeem starten...","Klaar!"],pl:["Ładowanie zasobów...","Przygotowywanie czcionek...","Konfigurowanie motywów...","Uruchamianie systemu...","Gotowe!"],sv:["Laddar resurser...","Förbereder typsnitt...","Konfigurerar teman...","Startar systemet...","Redo!"],vi:["Đang tải tài nguyên...","Đang chuẩn bị phông chữ...","Đang cấu hình chủ đề...","Đang khởi động hệ thống...","Sẵn sàng!"],th:["กำลังโหลดทรัพยากร...","กำลังเตรียมแบบอักษร...","กำลังกำหนดค่าธีม...","กำลังเริ่มระบบ...","พร้อม!"],el:["Φόρτωση πόρων...","Προετοιμασία γραμματοσειρών...","Διαμόρφωση θεμάτων...","Εκκίνηση συστήματος...","Έτοιμο!"],uk:["Завантаження ресурсів...","Підготовка шрифтів...","Налаштування тем...","Запуск системи...","Готово!"]},l=r[currentLang]||r.en,i=setInterval(()=>{if(s+=10*Math.random(),s>90&&(s=90),n.style.setProperty("--progress",`${s}%`),a&&(a.textContent=`${Math.round(s)}%`),o){const e=Math.floor(s/100*(l.length-1));o.textContent=l[e]||l[0]}},100);Promise.all([document.fonts.ready,e,new Promise(e=>{"complete"===document.readyState?e():window.addEventListener("load",e)})]).then(()=>{setupWidgetControls(),setupAnimationSwitcher(),startBlobAnimation(),[document.getElementById("hours"),document.getElementById("minutes")].forEach(e=>{e&&e.addEventListener("input",()=>{const t=e.max.length;e.value.length>t&&(e.value=e.value.slice(0,t));const n=parseInt(e.value),a=parseInt(e.max);!isNaN(n)&&!isNaN(a)&&n>a&&(e.value=a)})});const e=localStorage.getItem("countdown_theme");e&&"default"!==e&&document.body.setAttribute("data-theme",e)}).catch(e=>console.error("Loading error:",e)).finally(()=>{clearInterval(i),n.style.setProperty("--progress","100%"),a&&(a.textContent="100%"),o&&(o.textContent=l[l.length-1]),setTimeout(()=>{t.classList.add("hidden"),setTimeout(()=>t.remove(),500)},500)})}}),document.addEventListener("keydown",e=>{const t=document.querySelector(".modal.open");t&&"Escape"===e.key&&t.classList.remove("open")});